/* esm.sh - three@0.177.0/examples/jsm/loaders/RGBELoader */
import{DataTextureLoader as Y,DataUtils as b,FloatType as S,HalfFloatType as B,LinearFilter as V,LinearSRGBColorSpace as $}from"../../../three.mjs";var u=class extends Y{constructor(g){super(g),this.type=B}parse(g){let _=function(r,a){switch(r){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(a||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(a||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(a||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(a||""))}},N=`
`,D=function(r,a,t){a=a||1024;let l=r.pos,i=-1,e=0,s="",n=String.fromCharCode.apply(null,new Uint16Array(r.subarray(l,l+128)));for(;0>(i=n.indexOf(N))&&e<a&&l<r.byteLength;)s+=n,e+=n.length,l+=128,n+=String.fromCharCode.apply(null,new Uint16Array(r.subarray(l,l+128)));return-1<i?(t!==!1&&(r.pos+=e+i+1),s+n.slice(0,i)):!1},v=function(r){let a=/^#\?(\S+)/,t=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,l=/^\s*FORMAT=(\S+)\s*$/,i=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,e={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0},s,n;for((r.pos>=r.byteLength||!(s=D(r)))&&_(1,"no header found"),(n=s.match(a))||_(3,"bad initial token"),e.valid|=1,e.programtype=n[1],e.string+=s+`
`;s=D(r),s!==!1;){if(e.string+=s+`
`,s.charAt(0)==="#"){e.comments+=s+`
`;continue}if((n=s.match(t))&&(e.gamma=parseFloat(n[1])),(n=s.match(o))&&(e.exposure=parseFloat(n[1])),(n=s.match(l))&&(e.valid|=2,e.format=n[1]),(n=s.match(i))&&(e.valid|=4,e.height=parseInt(n[1],10),e.width=parseInt(n[2],10)),e.valid&2&&e.valid&4)break}return e.valid&2||_(3,"missing format specifier"),e.valid&4||_(3,"missing image size specifier"),e},x=function(r,a,t){let o=a;if(o<8||o>32767||r[0]!==2||r[1]!==2||r[2]&128)return new Uint8Array(r);o!==(r[2]<<8|r[3])&&_(3,"wrong scanline width");let l=new Uint8Array(4*a*t);l.length||_(4,"unable to allocate buffer space");let i=0,e=0,s=4*o,n=new Uint8Array(4),E=new Uint8Array(s),H=t;for(;H>0&&e<r.byteLength;){e+4>r.byteLength&&_(1),n[0]=r[e++],n[1]=r[e++],n[2]=r[e++],n[3]=r[e++],(n[0]!=2||n[1]!=2||(n[2]<<8|n[3])!=o)&&_(3,"bad rgbe scanline format");let R=0,c;for(;R<s&&e<r.byteLength;){c=r[e++];let h=c>128;if(h&&(c-=128),(c===0||R+c>s)&&_(3,"bad scanline data"),h){let m=r[e++];for(let U=0;U<c;U++)E[R++]=m}else E.set(r.subarray(e,e+c),R),R+=c,e+=c}let z=o;for(let h=0;h<z;h++){let m=0;l[i]=E[h+m],m+=o,l[i+1]=E[h+m],m+=o,l[i+2]=E[h+m],m+=o,l[i+3]=E[h+m],i+=4}H--}return l},C=function(r,a,t,o){let l=r[a+3],i=Math.pow(2,l-128)/255;t[o+0]=r[a+0]*i,t[o+1]=r[a+1]*i,t[o+2]=r[a+2]*i,t[o+3]=1},P=function(r,a,t,o){let l=r[a+3],i=Math.pow(2,l-128)/255;t[o+0]=b.toHalfFloat(Math.min(r[a+0]*i,65504)),t[o+1]=b.toHalfFloat(Math.min(r[a+1]*i,65504)),t[o+2]=b.toHalfFloat(Math.min(r[a+2]*i,65504)),t[o+3]=b.toHalfFloat(1)},w=new Uint8Array(g);w.pos=0;let d=v(w),k=d.width,f=d.height,y=x(w.subarray(w.pos),k,f),I,L,p;switch(this.type){case S:p=y.length/4;let r=new Float32Array(p*4);for(let t=0;t<p;t++)C(y,t*4,r,t*4);I=r,L=S;break;case B:p=y.length/4;let a=new Uint16Array(p*4);for(let t=0;t<p;t++)P(y,t*4,a,t*4);I=a,L=B;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:k,height:f,data:I,header:d.string,gamma:d.gamma,exposure:d.exposure,type:L}}setDataType(g){return this.type=g,this}load(g,G,A,F){function M(_,T){switch(_.type){case S:case B:_.colorSpace=$,_.minFilter=V,_.magFilter=V,_.generateMipmaps=!1,_.flipY=!0;break}G&&G(_,T)}return super.load(g,M,A,F)}};export{u as RGBELoader};
//# sourceMappingURL=RGBELoader.mjs.map